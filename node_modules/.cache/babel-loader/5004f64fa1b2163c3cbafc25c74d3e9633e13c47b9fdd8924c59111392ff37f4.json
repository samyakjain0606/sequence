{"ast":null,"code":"import{useState,useEffect,useCallback}from'react';import*as LocalStorage from'../utils/localStorage';// Function to get the correct WebSocket URL based on environment\nexport const getWebSocketUrl=()=>{// For local development\nif(process.env.NODE_ENV==='development'){return'ws://localhost:3001/ws';}// For production (Vercel)\nconst protocol=window.location.protocol==='https:'?'wss':'ws';return`${protocol}://${window.location.host}/ws`;};export const useWebSocket=url=>{// Use provided URL or get the default one based on environment\nconst wsUrl=url||getWebSocketUrl();const[ws,setWs]=useState(null);const[isConnected,setIsConnected]=useState(false);const[gameId,setGameId]=useState(()=>LocalStorage.getGameId());const[error,setError]=useState(null);const[players,setPlayers]=useState(()=>LocalStorage.getPlayers()||[]);const[isGameStarted,setIsGameStarted]=useState(()=>LocalStorage.getIsGameStarted());const[gameState,setGameState]=useState(()=>LocalStorage.getGameState());const[playerId,setPlayerId]=useState(()=>LocalStorage.getPlayerId());const[reconnectAttempt,setReconnectAttempt]=useState(0);const handleMessage=useCallback(message=>{console.log('Processing WebSocket message:',{type:message.type,payload:message.payload,currentPlayerId:playerId,currentGameId:gameId});switch(message.type){case'GAME_CREATED':console.log('Game created, setting player ID:',message.payload.playerId);setGameId(message.payload.gameId);setPlayerId(message.payload.playerId);setPlayers([{id:message.payload.playerId,name:message.payload.playerName}]);break;case'GAME_JOINED':console.log('Game joined, setting player ID and game ID:',{playerId:message.payload.playerId,gameId:message.payload.gameId});setGameId(message.payload.gameId);setPlayerId(message.payload.playerId);setPlayers(message.payload.players);break;case'PLAYER_JOINED':console.log('Player joined, updating players list and ensuring gameId is set:',{players:message.payload.players,gameId:message.payload.gameId,currentGameId:gameId});// Make sure gameId is set if available\nif(message.payload.gameId&&!gameId){setGameId(message.payload.gameId);}setPlayers(message.payload.players);break;case'GAME_STARTED':console.log('Game started, current player ID and game ID:',{playerId,gameId:message.payload.gameId||gameId});// Ensure gameId is set if available\nif(message.payload.gameId&&!gameId){setGameId(message.payload.gameId);}setIsGameStarted(true);setGameState(message.payload.gameState);setPlayers(message.payload.players);// Ensure we have the correct player ID\nif(message.payload.playerId){console.log('Setting player ID from game start:',message.payload.playerId);setPlayerId(message.payload.playerId);}break;case'GAME_STATE_UPDATED':setGameState(message.payload.gameState);// Ensure gameId is set if available\nif(message.payload.gameId&&!gameId){console.log('Setting gameId from game state update:',message.payload.gameId);setGameId(message.payload.gameId);}break;case'RECONNECT_SUCCESS':console.log('Reconnection successful:',message.payload);// Update all game state with the received data\nsetGameId(message.payload.gameId);setPlayerId(message.payload.playerId);setPlayers(message.payload.players);setIsGameStarted(true);setGameState(message.payload.gameState);break;case'ERROR':console.error('Server error:',message.payload.message,{currentPlayerId:playerId,currentGameId:gameId});setError(message.payload.message);break;default:console.warn('Unknown message type:',message.type);}},[playerId,gameId]);const connect=useCallback(()=>{try{console.log('Attempting to connect to WebSocket server...',{existingGameId:gameId,existingPlayerId:playerId,isGameStarted});const websocket=new WebSocket(wsUrl);websocket.onopen=()=>{console.log('WebSocket connection established');setIsConnected(true);setError(null);setReconnectAttempt(0);// If we have a gameId and playerId, attempt to reconnect to the game\nif(gameId&&playerId&&isGameStarted){console.log('Attempting to reconnect to existing game:',{gameId,playerId});// Send a reconnect message to the server\nconst message=JSON.stringify({type:'RECONNECT',payload:{gameId,playerId}});websocket.send(message);}};websocket.onclose=event=>{console.log('WebSocket connection closed:',event);setIsConnected(false);// Attempt to reconnect if the game is in progress\nif(isGameStarted&&reconnectAttempt<3){console.log('Attempting to reconnect...',{attempt:reconnectAttempt+1});setTimeout(()=>{setReconnectAttempt(prev=>prev+1);connect();},1000*(reconnectAttempt+1));// Exponential backoff\n}};websocket.onerror=error=>{console.error('WebSocket error:',error);setError('Failed to connect to server');};websocket.onmessage=event=>{try{const message=JSON.parse(event.data);console.log('WebSocket received message:',{type:message.type,payload:message.payload,timestamp:new Date().toISOString()});handleMessage(message);}catch(error){console.error('Error handling message:',error);}};setWs(websocket);}catch(error){console.error('Error creating WebSocket connection:',error);setError('Failed to create WebSocket connection');}},[wsUrl,isGameStarted,reconnectAttempt,gameId,playerId,handleMessage]);useEffect(()=>{connect();return()=>{if(ws){ws.close();}};},[connect,ws]);// Save game state to localStorage whenever relevant state changes\nuseEffect(()=>{if(gameId){LocalStorage.saveGameId(gameId);}},[gameId]);useEffect(()=>{if(playerId){LocalStorage.savePlayerId(playerId);}},[playerId]);useEffect(()=>{if(gameState){LocalStorage.saveGameState(gameState);}},[gameState]);useEffect(()=>{LocalStorage.saveIsGameStarted(isGameStarted);},[isGameStarted]);useEffect(()=>{if(players.length>0){LocalStorage.savePlayers(players);}},[players]);const sendMessage=useCallback((type,payload)=>{console.log('Preparing to send message:',{type,payload,currentPlayerId:playerId,currentGameId:gameId});if(!ws){console.error('No WebSocket instance available');setError('No connection available');return;}if(ws.readyState!==WebSocket.OPEN){console.error('WebSocket not in OPEN state:',{readyState:ws.readyState,readyStateString:['CONNECTING','OPEN','CLOSING','CLOSED'][ws.readyState],isConnected});setError('Connection not ready');return;}try{// We no longer need to add playerId to MAKE_MOVE messages\n// The server identifies players by their WebSocket connection\nconst message=JSON.stringify({type,payload});console.log('Sending WebSocket message:',{type,payload,currentPlayerId:playerId,// for debugging only\ntimestamp:new Date().toISOString()});ws.send(message);}catch(error){console.error('Error sending message:',error);setError('Failed to send message');}},[ws,isConnected,playerId,gameId]);return{sendMessage,gameId,error,isConnected,players,isGameStarted,gameState,playerId};};","map":{"version":3,"names":["useState","useEffect","useCallback","LocalStorage","getWebSocketUrl","process","env","NODE_ENV","protocol","window","location","host","useWebSocket","url","wsUrl","ws","setWs","isConnected","setIsConnected","gameId","setGameId","getGameId","error","setError","players","setPlayers","getPlayers","isGameStarted","setIsGameStarted","getIsGameStarted","gameState","setGameState","getGameState","playerId","setPlayerId","getPlayerId","reconnectAttempt","setReconnectAttempt","handleMessage","message","console","log","type","payload","currentPlayerId","currentGameId","id","name","playerName","warn","connect","existingGameId","existingPlayerId","websocket","WebSocket","onopen","JSON","stringify","send","onclose","event","attempt","setTimeout","prev","onerror","onmessage","parse","data","timestamp","Date","toISOString","close","saveGameId","savePlayerId","saveGameState","saveIsGameStarted","length","savePlayers","sendMessage","readyState","OPEN","readyStateString"],"sources":["/Users/samjain/seq/sequence/src/hooks/useWebSocket.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\nimport { WebSocketMessage } from '../server/types';\nimport { GameState } from '../models/types';\nimport * as LocalStorage from '../utils/localStorage';\n\n// Function to get the correct WebSocket URL based on environment\nexport const getWebSocketUrl = (): string => {\n  // For local development\n  if (process.env.NODE_ENV === 'development') {\n    return 'ws://localhost:3001/ws';\n  }\n  \n  // For production (Vercel)\n  const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';\n  return `${protocol}://${window.location.host}/ws`;\n};\n\ninterface UseWebSocketReturn {\n  sendMessage: (type: string, payload: any) => void;\n  gameId: string | null;\n  error: string | null;\n  isConnected: boolean;\n  players: { id: string; name: string }[];\n  isGameStarted: boolean;\n  gameState: GameState | null;\n  playerId: string | null;\n}\n\nexport const useWebSocket = (url?: string): UseWebSocketReturn => {\n  // Use provided URL or get the default one based on environment\n  const wsUrl = url || getWebSocketUrl();\n  const [ws, setWs] = useState<WebSocket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [gameId, setGameId] = useState<string | null>(() => LocalStorage.getGameId());\n  const [error, setError] = useState<string | null>(null);\n  const [players, setPlayers] = useState<{ id: string; name: string }[]>(() => LocalStorage.getPlayers() || []);\n  const [isGameStarted, setIsGameStarted] = useState<boolean>(() => LocalStorage.getIsGameStarted());\n  const [gameState, setGameState] = useState<GameState | null>(() => LocalStorage.getGameState());\n  const [playerId, setPlayerId] = useState<string | null>(() => LocalStorage.getPlayerId());\n  const [reconnectAttempt, setReconnectAttempt] = useState(0);\n\n  const handleMessage = useCallback((message: WebSocketMessage) => {\n    console.log('Processing WebSocket message:', {\n      type: message.type,\n      payload: message.payload,\n      currentPlayerId: playerId,\n      currentGameId: gameId\n    });\n    \n    switch (message.type) {\n      case 'GAME_CREATED':\n        console.log('Game created, setting player ID:', message.payload.playerId);\n        setGameId(message.payload.gameId);\n        setPlayerId(message.payload.playerId);\n        setPlayers([{ id: message.payload.playerId, name: message.payload.playerName }]);\n        break;\n\n      case 'GAME_JOINED':\n        console.log('Game joined, setting player ID and game ID:', {\n          playerId: message.payload.playerId,\n          gameId: message.payload.gameId\n        });\n        setGameId(message.payload.gameId);\n        setPlayerId(message.payload.playerId);\n        setPlayers(message.payload.players);\n        break;\n\n      case 'PLAYER_JOINED':\n        console.log('Player joined, updating players list and ensuring gameId is set:', {\n          players: message.payload.players,\n          gameId: message.payload.gameId,\n          currentGameId: gameId\n        });\n        \n        // Make sure gameId is set if available\n        if (message.payload.gameId && !gameId) {\n          setGameId(message.payload.gameId);\n        }\n        \n        setPlayers(message.payload.players);\n        break;\n\n      case 'GAME_STARTED':\n        console.log('Game started, current player ID and game ID:', {\n          playerId,\n          gameId: message.payload.gameId || gameId\n        });\n        \n        // Ensure gameId is set if available\n        if (message.payload.gameId && !gameId) {\n          setGameId(message.payload.gameId);\n        }\n        \n        setIsGameStarted(true);\n        setGameState(message.payload.gameState);\n        setPlayers(message.payload.players);\n        \n        // Ensure we have the correct player ID\n        if (message.payload.playerId) {\n          console.log('Setting player ID from game start:', message.payload.playerId);\n          setPlayerId(message.payload.playerId);\n        }\n        break;\n\n      case 'GAME_STATE_UPDATED':\n        setGameState(message.payload.gameState);\n        \n        // Ensure gameId is set if available\n        if (message.payload.gameId && !gameId) {\n          console.log('Setting gameId from game state update:', message.payload.gameId);\n          setGameId(message.payload.gameId);\n        }\n        break;\n\n      case 'RECONNECT_SUCCESS':\n        console.log('Reconnection successful:', message.payload);\n        \n        // Update all game state with the received data\n        setGameId(message.payload.gameId);\n        setPlayerId(message.payload.playerId);\n        setPlayers(message.payload.players);\n        setIsGameStarted(true);\n        setGameState(message.payload.gameState);\n        break;\n\n      case 'ERROR':\n        console.error('Server error:', message.payload.message, {\n          currentPlayerId: playerId,\n          currentGameId: gameId\n        });\n        setError(message.payload.message);\n        break;\n\n      default:\n        console.warn('Unknown message type:', message.type);\n    }\n  }, [playerId, gameId]);\n\n  const connect = useCallback(() => {\n    try {\n      console.log('Attempting to connect to WebSocket server...', {\n        existingGameId: gameId,\n        existingPlayerId: playerId,\n        isGameStarted\n      });\n      \n      const websocket = new WebSocket(wsUrl);\n\n      websocket.onopen = () => {\n        console.log('WebSocket connection established');\n        setIsConnected(true);\n        setError(null);\n        setReconnectAttempt(0);\n        \n        // If we have a gameId and playerId, attempt to reconnect to the game\n        if (gameId && playerId && isGameStarted) {\n          console.log('Attempting to reconnect to existing game:', {\n            gameId,\n            playerId\n          });\n          \n          // Send a reconnect message to the server\n          const message = JSON.stringify({\n            type: 'RECONNECT',\n            payload: {\n              gameId,\n              playerId\n            }\n          });\n          websocket.send(message);\n        }\n      };\n\n      websocket.onclose = (event) => {\n        console.log('WebSocket connection closed:', event);\n        setIsConnected(false);\n        \n        // Attempt to reconnect if the game is in progress\n        if (isGameStarted && reconnectAttempt < 3) {\n          console.log('Attempting to reconnect...', { attempt: reconnectAttempt + 1 });\n          setTimeout(() => {\n            setReconnectAttempt(prev => prev + 1);\n            connect();\n          }, 1000 * (reconnectAttempt + 1)); // Exponential backoff\n        }\n      };\n\n      websocket.onerror = (error) => {\n        console.error('WebSocket error:', error);\n        setError('Failed to connect to server');\n      };\n\n      websocket.onmessage = (event) => {\n        try {\n          const message: WebSocketMessage = JSON.parse(event.data);\n          console.log('WebSocket received message:', {\n            type: message.type,\n            payload: message.payload,\n            timestamp: new Date().toISOString()\n          });\n          handleMessage(message);\n        } catch (error) {\n          console.error('Error handling message:', error);\n        }\n      };\n\n      setWs(websocket);\n    } catch (error) {\n      console.error('Error creating WebSocket connection:', error);\n      setError('Failed to create WebSocket connection');\n    }\n  }, [wsUrl, isGameStarted, reconnectAttempt, gameId, playerId, handleMessage]);\n\n  useEffect(() => {\n    connect();\n    return () => {\n      if (ws) {\n        ws.close();\n      }\n    };\n  }, [connect, ws]);\n\n  // Save game state to localStorage whenever relevant state changes\n  useEffect(() => {\n    if (gameId) {\n      LocalStorage.saveGameId(gameId);\n    }\n  }, [gameId]);\n\n  useEffect(() => {\n    if (playerId) {\n      LocalStorage.savePlayerId(playerId);\n    }\n  }, [playerId]);\n\n  useEffect(() => {\n    if (gameState) {\n      LocalStorage.saveGameState(gameState);\n    }\n  }, [gameState]);\n\n  useEffect(() => {\n    LocalStorage.saveIsGameStarted(isGameStarted);\n  }, [isGameStarted]);\n\n  useEffect(() => {\n    if (players.length > 0) {\n      LocalStorage.savePlayers(players);\n    }\n  }, [players]);\n\n  const sendMessage = useCallback((type: string, payload: any) => {\n    console.log('Preparing to send message:', { \n      type, \n      payload,\n      currentPlayerId: playerId,\n      currentGameId: gameId\n    });\n    \n    if (!ws) {\n      console.error('No WebSocket instance available');\n      setError('No connection available');\n      return;\n    }\n\n    if (ws.readyState !== WebSocket.OPEN) {\n      console.error('WebSocket not in OPEN state:', {\n        readyState: ws.readyState,\n        readyStateString: ['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'][ws.readyState],\n        isConnected\n      });\n      setError('Connection not ready');\n      return;\n    }\n\n    try {\n      // We no longer need to add playerId to MAKE_MOVE messages\n      // The server identifies players by their WebSocket connection\n      \n      const message = JSON.stringify({ type, payload });\n      console.log('Sending WebSocket message:', {\n        type,\n        payload,\n        currentPlayerId: playerId, // for debugging only\n        timestamp: new Date().toISOString()\n      });\n      ws.send(message);\n    } catch (error) {\n      console.error('Error sending message:', error);\n      setError('Failed to send message');\n    }\n  }, [ws, isConnected, playerId, gameId]);\n\n  return {\n    sendMessage,\n    gameId,\n    error,\n    isConnected,\n    players,\n    isGameStarted,\n    gameState,\n    playerId\n  };\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}